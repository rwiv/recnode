#name: Build and Deploy
#on:
#  push:
#    branches:
#      - "**"
#env:
#  CHART_SRC_PATH: kube/chart
#  CHART_OUT_DIRPATH: apps/media/stdl
#  CHART_OUT_FILENAME: main.yaml
#  GITOPS_REPO: rwiv/gitops-prod
#jobs:
#  Update-Git-Repository:
#    runs-on: ubuntu-latest
#    steps:
#      - name: Setup helm
#        uses: azure/setup-helm@v4.2.0
#      - name: Checkout current repo
#        uses: actions/checkout@v4
#        with:
#          path: main
#      - name: Checkout gitops-test repo
#        uses: actions/checkout@v4
#        with:
#          repository: ${{ env.GITOPS_REPO }}
#          token: ${{ secrets.MY_GITHUB_TOKEN }}
#          path: gitops
#
#      - name: Write k8s manifest files
#        run: |
#          mkdir -p gitops/${{ env.CHART_OUT_DIRPATH }}
#          helm template main/${{ env.CHART_SRC_PATH }} \
#            > gitops/${{ env.CHART_OUT_DIRPATH }}/${{ env.CHART_OUT_FILENAME }}
#
#      - name: Git Push
#        run: |
#          cd gitops
#          if [[ -z $(git status --porcelain) ]]; then
#            echo "No changes to commit"
#            exit 0
#          fi
#          git config --global user.name "github-actions[bot]"
#          git config --global user.email "github-actions[bot]@users.noreply.github.com"
#          git add .
#          git commit -m "Update from GitHub Actions"
#          git push origin main
#        env:
#          GITHUB_TOKEN: ${{ secrets.MY_GITHUB_TOKEN }}
